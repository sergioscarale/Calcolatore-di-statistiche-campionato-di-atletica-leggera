<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: versione 2 - avanzata.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: versione 2 - avanzata.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const prompt=require("prompt-sync")();
const fs=require('fs');

/**
 *@author  Sergio Scarale,Matteo De Bonis,Davide Cocomazzi,Biagio Piazza
*/

/**
 * @description Classe che crea l'oggetto partecipante
 * @class
 */
class Partecipante
{
    /**
     * Crea un partecipante.
     * @param {string} nome - Il nome del partecipante
     * @param {string} cognome - Il cognome del partecipante
     * @param {string} sesso - Il sesso del partecipante
     * @param {string} data - La data di nascita del partecipante
     * @param {string} nazionalita - La nazionalità del partecipante
     */
    constructor(nome,cognome,sesso,data,nazionalita)
    {
        this.nome=nome;
        this.cognome=cognome;
        this.sesso=sesso;
        this.data=data;
        this.nazionalita=nazionalita;
    }
}

/**
 * @description Classe che rappresenta una gara.
 * @class
 */
class Gara
{
    constructor(tipo_gara,tempo,partecipante)
    {
        /**
        * Crea una gara.
        * @param {string} tipo_gara - Il tipo di gara
        * @param {string} tempo - Il tempo impiegato per completare la gara
        * @param {Partecipante} partecipante - Il partecipante alla gara
        */
        this.tipo_gara=tipo_gara;
        this.tempo=tempo;
        this.partecipante=partecipante;
    }
}

/**
 * Controlla se una variabile è vuota.
 * @function
 * @param {string} variabile - La variabile da controllare
 * @returns {boolean} - Ritorna true se la variabile è vuota, altrimenti false
 */
function controlloSpazioVuoto(variabile)
{
    if(variabile.trim()==="")
    {  
        console.log("Inserimento non valido!\n")
        return true;
    }
    return false;
}

/**
 * Controlla l'ID del partecipante.
 * @function
 * @returns {string} - Ritorna l'ID del partecipante se è valido
 */
function controlloId()
{
    while(true)
    {
        console.log("\nInserisci l'ID del partecipante (solo numeri) ")
        chiave=prompt(">> ");
        let controllo_chiave=true;
        for(let i=0;i&lt;chiave.length;i++)
        {
            if(chiave.charAt(i)&lt;'0' || chiave.charAt(i)>'9')
            {
                controllo_chiave=false; break;
            }
        }
        if(controllo_chiave &amp;&amp; chiave.trim()!=="")
        {
            break;
        }
        else
        {
            console.log("L'ID dev'essere un numero!");
        }
    }
    return chiave;
}

/**
 * Registra un partecipante.
 * @function
 * @param {Map&lt;string, Partecipante>} partecipante_map - La mappa dei partecipanti
 */
function r_dati(partecipante_map)
{
    console.clear();
    let chiave=controlloId();

    if(!partecipante_map.has(chiave))
    {
        let nome=prompt("Nome: ");          
        if(controlloSpazioVuoto(nome)) return;
        
        let cognome=prompt("Cognome: ");
        if(controlloSpazioVuoto(cognome)) return;

        let sesso=prompt("Sesso: ");
        if(controlloSpazioVuoto(sesso)) return;

        let data=prompt("Data di nascita: ");
        if(controlloSpazioVuoto(data)) return;

        let nazionalita=prompt("Nazionalità: ");
        if(controlloSpazioVuoto(nazionalita)) return;

        let partecipante=new Partecipante(nome,cognome,sesso,data,nazionalita);
        partecipante_map.set(chiave,partecipante);
        console.log("\nPartecipante iscritto correttamente!\n");
    } 
    else
    {
        console.log("Partecipante già iscritto!\n");
    }
}

/**
 * @description - Genera un tempo casuale per una gara tra 9.6 e 30 secondi.
 * @function
 * @returns {string} - Il tempo generato per la gara.
 */
function casuale()
{
    let tempo=9.6+Math.random()*(30-9.6);
    return tempo.toFixed(2);
}

/**
 * Controlla la partecipazione a una gara
 * @function
 * @param {string} tipo_gara - Il tipo di gara
 * @param {Map&lt;string, Partecipante>} partecipante_map - La mappa dei partecipanti
 * @param {Map&lt;string, Gara>} gara_map - La mappa delle gare
 * @description Controlla se un partecipante è già iscritto a una gara di un determinato tipo e, in caso contrario, lo iscrive.
 */
function controllo_gara(tipo_gara, partecipante_map, gara_map)
{
    let chiave;
    chiave=controlloId();
    if(partecipante_map.has(chiave))
    {
        let partecipante=partecipante_map.get(chiave);
        let iscritto=Array.from(gara_map.values()).some(gara=>gara.partecipante===partecipante &amp;&amp; gara.tipo_gara===tipo_gara);
        if(!iscritto)
        {
            let oggetto_gara=new Gara(tipo_gara,casuale(),partecipante);
            gara_map.set(chiave+"-"+tipo_gara,oggetto_gara);
        } 
        else
        {
            console.log("Il partecipante ha già partecipato a una gara di questo tipo.\n");
        }
    } 
    else 
    {
        console.log("Partecipante non presente!");
    }
}

/**
 * Legge i tipi di gara dal file tipi_gara.txt.
 * @function
 * @returns {string[]} - Un array di tipi di gara
 */
function leggiTipiGaraDaFile()
{
    try 
    {
        let file=fs.readFileSync('tipi_gara.txt','utf8');
        return file.split('\n').map(riga=>riga.trim());
    } 
    catch(err) 
    {
        console.error("Errore nella lettura del file dei tipi di gara:", err);
        return [];
    }
}

/**
 * Controlla se un tipo di gara è valido.
 * @function
 * @param {string} tipoGara - Il tipo di gara da controllare
 * @returns {boolean} - Ritorna true se il tipo di gara è valido, altrimenti false
 */
function tipoGaraValido(tipoGara) 
{
    let tipiGara=leggiTipiGaraDaFile();
    return tipiGara.includes(tipoGara);
}

/**
 * @description Registra le gare chiedendo all'utente i dettagli della gara e i partecipanti
 * @function
 * @param {Map&lt;string, Partecipante>} partecipante_map - La mappa dei partecipanti
 * @param {Map&lt;string, Gara>} gara_map - La mappa delle gare
 */
function r_gare(partecipante_map, gara_map)
{
    let scelta, tipo_gara;
    console.log("\nGARA\n");
    tipo_gara = prompt("Inserisci il tipo di gara: ");
    if (controlloSpazioVuoto(tipo_gara)) return;

    if (!tipoGaraValido(tipo_gara)) 
    {
        console.log("Tipo di gara non valido!\n");
        return;
    }

    // Verifica se il tipo di gara è già stato registrato
    let garaRegistrata=Array.from(gara_map.values()).map(gara=>gara.tipo_gara);
    if (!garaRegistrata.includes(tipo_gara))
    {
        do
        {
            controllo_gara(tipo_gara, partecipante_map, gara_map);
            console.log("\nsi per continuare ad inserire;\nno per uscire;\n");
            scelta = prompt(">> ");
        } while (scelta.toLowerCase() !== "no");
    }
    else
    {
        console.log("Tipo di gara già inserito!");
        return;
    }
}

/**
 * @description Stampa tutte le gare registrate con i dettagli dei partecipanti
 * Stampa le gare registrate.
 * @function
 * @param {Map&lt;string, Gara>} gara_map - La mappa delle gare
 */
function stampaGara(gara_map)
{
    console.log("Gara_map:");
    gara_map.forEach((gara, chiave) => 
    {
        console.log(`ID Partecipante e Tipo di Gara: ${chiave}`);
        console.log(`Tipo di gara: ${gara.tipo_gara}`);
        console.log(`Tempo: ${gara.tempo}`);
        console.log(`Partecipante: ${gara.partecipante.nome} ${gara.partecipante.cognome}`);
    });
}

/**
 * @description Crea e aggiorna la classifica del campionato basata sui tempi delle varie gare
 * Crea e aggiorna la classifica del campionato
 * @function
 * @param {Map&lt;string, Gara>} gara_map - La mappa delle gare
 * @param {Object} classificaPerTipo - La classifica per tipo di gara
 */
function classifica(gara_map,classificaPerTipo)
{
    console.clear();
    console.log("\nCLASSIFICA\n");

    //Resetta l'oggetto classificaPerTipo per evitare duplicazioni
    Object.keys(classificaPerTipo).forEach(key=>delete classificaPerTipo[key]);

    gara_map.forEach((gara)=>
    {
        const tipo_gara=gara.tipo_gara;
        if(!classificaPerTipo[tipo_gara])
        {
            classificaPerTipo[tipo_gara]=[];
        }
        classificaPerTipo[tipo_gara].push(
        {
            nome: gara.partecipante.nome,
            cognome: gara.partecipante.cognome,
            tempo: parseFloat(gara.tempo)
        });
    });

    for(const tipo_gara in classificaPerTipo)
    {
        console.log(`Classifica per: ${tipo_gara}`);
        classificaPerTipo[tipo_gara].sort((a, b) => a.tempo - b.tempo);
        classificaPerTipo[tipo_gara].forEach((corridore, posizione)=> 
        {
            console.log(`${posizione + 1}. ${corridore.nome} ${corridore.cognome} - Tempo: ${corridore.tempo} secondi`);
        });
        console.log("\n");
    }
}

/**
 * @description Calcola e stampa la media dei tempi per ogni tipo di gara.
 * @function
 * @param {Map&lt;string, Gara>} gara_map - La mappa delle gare
 */
function calcoloMedia(gara_map)
{
    console.clear();
    const mediaTipoGara={};
    gara_map.forEach(gara=>
                    {
                        const tipoGara=gara.tipo_gara;
                        if(!mediaTipoGara[tipoGara])
                        {
                            mediaTipoGara[tipoGara]=
                            {
                                sommaTempi: 0,
                                conteggioGare: 0
                            }
                        }
                        mediaTipoGara[tipoGara].sommaTempi+=parseFloat(gara.tempo);
                        mediaTipoGara[tipoGara].conteggioGare++;
                    })
    console.log("\nMEDIE TEMPI PER OGNI TIPO DI GARA\n");
    for(let tipoGara in mediaTipoGara)
    {
        let sommaTempi=mediaTipoGara[tipoGara].sommaTempi;
        let conteggioGare=mediaTipoGara[tipoGara].conteggioGare;
        let media=sommaTempi/conteggioGare;
        console.log(`${tipoGara}: ${media.toFixed(2)} secondi\n`);
    }
}

/**
 * @description - Questa funzione calcola e visualizza le statistiche dei partecipanti alle gare.
 * @function
 * @param {Map} gara_map 
 */
function visualizzaStatistiche(gara_map) 
{
    console.clear();
    const statistichePerPartecipante=new Map();

    // Ottengo le statistiche di ogni partecipante
    gara_map.forEach(gara=> 
    {
        const chiave=`${gara.partecipante.nome} ${gara.partecipante.cognome}`;
        if(!statistichePerPartecipante.has(chiave)) 
        {
            statistichePerPartecipante.set(chiave, 
            {
                vinte: 0,
                podio: 0,
                fuoriPodio: 0,
                totali: 0
            });
        }
    });

    // Calcola classifica per ogni tipo di gara e aggiorna statistiche
    const classificaPerTipo={};
    gara_map.forEach(gara => 
    {
        const tipoGara=gara.tipo_gara;
        if(!classificaPerTipo[tipoGara]) 
        {
            classificaPerTipo[tipoGara]=[];
        }
        classificaPerTipo[tipoGara].push(
        {
            partecipante: gara.partecipante,
            tempo: parseFloat(gara.tempo)
        });
    });

    Object.keys(classificaPerTipo).forEach(tipoGara=>
    {
        classificaPerTipo[tipoGara].sort((a,b)=>a.tempo-b.tempo);
        classificaPerTipo[tipoGara].forEach((persona,posizione)=> 
        {
            let chiave=`${persona.partecipante.nome} ${persona.partecipante.cognome}`;
            let stats=statistichePerPartecipante.get(chiave);
            stats.totali++;

            // Incrementa vinte e podio quando vince
            if(posizione===0) 
            {
                stats.vinte++;
                stats.podio++;
            }
            // Incrementa podio per le posizioni 2 e 3
            else if(posizione&lt;=2) 
            {
                stats.podio++;
            } 
            // Incrementa fuoriPodio se non rientri tra le prime 3 posizioni
            else
            {
                stats.fuoriPodio++;
            }
            statistichePerPartecipante.set(chiave, stats);
        });
    });

    // Calcolo delle percentuali
    statistichePerPartecipante.forEach((stats,chiave)=> 
    {
        stats.percentualeVittorie=(stats.vinte/stats.totali)*100;
        stats.percentualePodi=(stats.podio/stats.totali)*100;
        stats.percentualeFuoriPodio=(stats.fuoriPodio/stats.totali)*100;
    });

    // Stampa delle statistiche
    console.log("\nSTATISTICHE DEI GIOCATORI\n");

    statistichePerPartecipante.forEach((stat, giocatore)=> 
    {
        console.log(`${giocatore}: `);
        console.log(`- Gare totali: ${stat.totali}`);
        console.log(`- Gare vinte: ${stat.vinte}, ${stat.percentualeVittorie.toFixed(2)}%`);
        console.log(`- Piazzamenti a podio: ${stat.podio}, ${stat.percentualePodi.toFixed(2)}%`);
        console.log(`- Piazzamenti fuori podio: ${stat.fuoriPodio}, ${stat.percentualeFuoriPodio.toFixed(2)}%`);
        console.log("");
    });
}

/**
 * @description - Funzione principale che gestisce il menu e l'esecuzione delle altre funzioni.
 * @function
 */
function main()
{
    console.clear();
    /**
     * @description Variabile per memorizzare la scelta dell'utente.
     * @type {number} 
     */
    let scelta;

    /**
     * @description Mappa dei partecipanti 
     * @type {Map&lt;string, Object>}
     */
    let partecipante_map=new Map();

    /**
     * @description Mappa delle gare.
     * @type {Map&lt;string, Object>} 
     */
    let gara_map=new Map();

    /**
     * @description Oggetto contenente le classifiche per tipo di gara.
     * @type {Object.&lt;string, Array>}
     */
    let classificaPerTipo={};
    console.log("Calcolatore di statistiche campionato di atletica leggera\n");
    do
    {
        console.log("VERSIONE 2 - Avanzata");
        console.log("0 - Esci;");
        console.log("1 - Registrazione dei principali dati anagrafici dei giocatori;");
        console.log("2 - Registrazione delle singole gare e dei relativi partecipanti;");
        console.log("3 - Creazione ed aggiornamento della classifica di campionato;");
        console.log("4 - Il calcolo della media dei punteggi;");
        console.log("5 - La visualizzazione della percentuale di gare vinte, dei piazzamenti a podio e fuori dal podio di ogni giocatore.\n");
        scelta=parseInt(prompt(">> "));
        switch (scelta)
        {
            case 0: console.log("\nciap ciap\n"); break;
            case 1: r_dati(partecipante_map); break;
            case 2: r_gare(partecipante_map, gara_map); break;
            case 3: classifica(gara_map,classificaPerTipo); break;
            case 4: calcoloMedia(gara_map); break;
            case 5: visualizzaStatistiche(gara_map); break;
        }
    }while(scelta!==0);
}

main();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Gara.html">Gara</a></li><li><a href="Partecipante.html">Partecipante</a></li></ul><h3>Global</h3><ul><li><a href="global.html#calcoloMedia">calcoloMedia</a></li><li><a href="global.html#casuale">casuale</a></li><li><a href="global.html#classifica">classifica</a></li><li><a href="global.html#controlloId">controlloId</a></li><li><a href="global.html#controlloSpazioVuoto">controlloSpazioVuoto</a></li><li><a href="global.html#controllo_gara">controllo_gara</a></li><li><a href="global.html#leggiTipiGaraDaFile">leggiTipiGaraDaFile</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#r_dati">r_dati</a></li><li><a href="global.html#r_gare">r_gare</a></li><li><a href="global.html#stampaGara">stampaGara</a></li><li><a href="global.html#tipoGaraValido">tipoGaraValido</a></li><li><a href="global.html#visualizzaStatistiche">visualizzaStatistiche</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed May 29 2024 00:24:06 GMT+0200 (Ora legale dell’Europa centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
